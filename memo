ã‚„ã£ãŸã­ï¼ç¯„å›²æŒ‡å®šã®ä¿®æ­£ã§ç›´ã£ãŸã®è‰¯ã‹ã£ãŸã§ã™ ğŸ‘
ã§ã€ã€Œã‚¯ãƒªã‚¢ã€ãƒœã‚¿ãƒ³ã®ä½“æ„ŸãŒé‡ã„ä»¶ã€ListObject ã®ãƒªã‚µã‚¤ã‚ºï¼ã‚¯ãƒªã‚¢ã®ã‚„ã‚Šæ–¹ã‚’å¤‰ãˆã‚‹ã¨ä¸€æ°—ã«é€Ÿããªã‚Šã¾ã™ã€‚ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®3ã¤ã ã‘ã€‚

é€Ÿãã™ã‚‹ã‚³ãƒ„ï¼ˆè¦ç‚¹ï¼‰
	1.	ã‚¼ãƒ­è¡Œã«è¿‘ã„ã‚µã‚¤ã‚ºã¸ä¸€ç™ºãƒªã‚µã‚¤ã‚º
ã€€ä»Šã® ResetMasterSize ã¯æ—¢å®šï¼ˆB4 ãŒç©ºãªã‚‰ 20,000 è¡Œï¼‰ã¾ã§åºƒã’ã¦ã‹ã‚‰ ClearContents ã—ã¦ã„ã¾ã™ã€‚ã“ã“ãŒé‡ã„ã€‚
ã€€â†’ ã‚¯ãƒªã‚¢æ™‚ã¯ ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ï¼ˆ= 0 è¡Œï¼‰ ã¸ç¸®ã‚ã‚‹ã®ãŒæœ€é€Ÿã§ã™ã€‚DataBodyRange.ClearContents è‡ªä½“ã‚’é¿ã‘ã‚‹ã®ãŒã‚­ãƒ¢ã€‚
	2.	AutoFilterè§£é™¤ã¯â€œã‚ã‚‹ã¨ãã ã‘â€
ã€€ShowAllData ã¯ãƒ•ã‚£ãƒ«ã‚¿æœªé©ç”¨çŠ¶æ…‹ã§å‘¼ã¶ã¨å†…éƒ¨çš„ã«é‡ã„ã§ã™ã€‚
ã€€â†’ If lo.AutoFilter.FilterMode Then lo.AutoFilter.ShowAllData
	3.	ç”»é¢/è¨ˆç®—/ã‚¤ãƒ™ãƒ³ãƒˆOFFã¯æ—¢ã«OK
ã€€ã“ã®3ã¤ã® OFF ã¯åŠ¹ã„ã¦ã„ã¾ã™ã€‚è¿½åŠ ã§ DisplayPageBreaks = False ã‚‚åœ°å‘³ã«åŠ¹ãã¾ã™ï¼ˆãƒšãƒ¼ã‚¸åˆ†å‰²ç·šã®å†è¨ˆç®—ã‚’é˜²ãï¼‰ã€‚

â¸»

å·®ã—æ›¿ãˆã‚³ãƒ¼ãƒ‰ï¼ˆæœ€å°æ”¹ä¿®ï¼‰

A. ã‚¯ãƒªã‚¢å°‚ç”¨ã®ã€Œè¶…è»½é‡ãƒªã‚µã‚¤ã‚ºã€ã‚’ç”¨æ„

'=== ã‚¯ãƒªã‚¢å°‚ç”¨ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ï¼ˆ0è¡Œï¼‰ã«ç¸®ã‚ã‚‹ ===
Private Sub ShrinkToHeaderOnly(lo As ListObject)
    If lo Is Nothing Then Exit Sub
    Dim ws As Worksheet: Set ws = lo.Parent
    Dim hdr As Range: Set hdr = lo.HeaderRowRange
    ' ãƒ‡ãƒ¼ã‚¿è¡Œã‚’æŒãŸãªã„ã‚µã‚¤ã‚ºã«ä¸€ç™ºãƒªã‚µã‚¤ã‚º
    lo.Resize hdr
End Sub

B. ClearData ã‚’é«˜é€Ÿç‰ˆã«ç½®ãæ›ãˆ

Public Sub ClearData()
    Dim prevCalc As XlCalculation
    Dim prevUpd As Boolean, prevEvt As Boolean, prevDisp As Boolean
    Dim prevPB As Boolean
    Dim t0 As Double: t0 = Timer

    If Len(CurrentMasterTableName) = 0 Then UsePipelineMain

    ' é«˜é€ŸåŒ–
    On Error Resume Next
    prevUpd = Application.ScreenUpdating
    prevEvt = Application.EnableEvents
    prevDisp = Application.DisplayAlerts
    prevCalc = Application.Calculation
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.DisplayAlerts = False
    Application.Calculation = xlCalculationManual
    On Error GoTo 0

    On Error GoTo EH
    Dim lo As ListObject
    Set lo = GetListObjectByName(CurrentMasterTableName)
    If Not lo Is Nothing Then
        ' ãƒšãƒ¼ã‚¸åˆ†å‰²ç·šã‚’æŠ‘æ­¢ï¼ˆåŠ¹ãï¼‰
        prevPB = lo.Parent.DisplayPageBreaks
        lo.Parent.DisplayPageBreaks = False

        ' ãƒ•ã‚£ãƒ«ã‚¿è§£é™¤ã¯ã€Œã‹ã‹ã£ã¦ã„ã‚‹æ™‚ã ã‘ã€
        On Error Resume Next
        If Not lo.AutoFilter Is Nothing Then
            If lo.AutoFilter.FilterMode Then lo.AutoFilter.ShowAllData
        End If
        On Error GoTo 0

        ' â˜…æœ€é‡è¦ï¼šãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã¸ç¸®ã‚ã‚‹ï¼ˆDataBodyRange.ClearContentsã¯ä½¿ã‚ãªã„ï¼‰
        ShrinkToHeaderOnly lo

        ' ã‚‚ã—ã€ŒåˆæœŸè¡Œã‚’ç¢ºä¿ã—ã¦ãŠããŸã„ã€é‹ç”¨ãªã‚‰ã€ã“ã“ã§è»½ãåºƒã’ã‚‹ï¼ˆä¾‹ï¼š1è¡Œã ã‘ï¼‰
        ' lo.Resize lo.HeaderRowRange.Resize(2, lo.HeaderRowRange.Columns.Count)
        lo.Parent.DisplayPageBreaks = prevPB
    End If

    ' ä¸­é–“ãƒ‡ãƒ¼ã‚¿ã®è§£æ”¾ï¼ˆæ—¢å­˜ã®ã¾ã¾ã§OKï¼‰
    HasRaw = False
    IsProcessed = False
    On Error Resume Next
    If (Not Not RawJoined) <> 0 Then Erase RawJoined
    If (Not Not m_baseRowIdx) <> 0 Then Erase m_baseRowIdx
    On Error GoTo 0
    m_baseTblName = ""
    Set TableData = Nothing
    Set KeyIndexSingle = Nothing
    Set KeyIndexMulti = Nothing

DONE:
    ' æˆ»ã™
    On Error Resume Next
    Application.ScreenUpdating = prevUpd
    Application.EnableEvents = prevEvt
    Application.DisplayAlerts = prevDisp
    Application.Calculation = prevCalc
    On Error GoTo 0

    MsgBox "åˆæœŸåŒ–ã—ã¾ã—ãŸã€‚ï¼ˆ" & Format(Timer - t0, "0.00") & "sï¼‰", vbInformation
    Exit Sub

EH:
    On Error Resume Next
    Application.ScreenUpdating = prevUpd
    Application.EnableEvents = prevEvt
    Application.DisplayAlerts = prevDisp
    Application.Calculation = prevCalc
    On Error GoTo 0
    MsgBox "ClearDataã§ã‚¨ãƒ©ãƒ¼: " & Err.Description, vbCritical
End Sub

ã“ã‚Œã§ã€Œå¤§é‡è¡Œã«ãƒªã‚µã‚¤ã‚ºâ†’ClearContentsã€ã®é‡ã„æ‰‹é †ã‚’å®Œå…¨ã«å›é¿ã§ãã¾ã™ã€‚
ä½“æ„Ÿã¯æ¡é•ã„ã«è»½ããªã‚‹ã¯ãšã€‚

â¸»

è£œè¶³ï¼ˆé‹ç”¨é¢ã®é¸æŠè‚¢ï¼‰
	â€¢	ã€ŒB4 ã®æ—¢å®šè¡Œæ•°ã€é‹ç”¨ã¯ Import æ™‚ã ã‘ã«ä½¿ã†
ã‚¯ãƒªã‚¢æ™‚ã¯ 0 è¡Œã€Import/Paste æ™‚ã«å¿…è¦ãªã ã‘ä¸€ç™ºã§åºƒã’ã‚‹ï¼ˆPasteToMasterByTable ã§ Resize æ¸ˆã¿ãªã‚‰ä¸è¦ï¼‰ã€‚
	â€¢	ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›¸å¼åŠ£åŒ–å¯¾ç­–
ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ãƒªã‚µã‚¤ã‚ºã¯æ›¸å¼ã‚’å£Šã—ã¾ã›ã‚“ãŒã€ã‚¹ã‚¿ã‚¤ãƒ«ãŒé‡ã„å ´åˆã¯
lo.TableStyle = "TableStyleLight1" ç­‰ã®è»½é‡ã‚¹ã‚¿ã‚¤ãƒ«ã¸å¤‰æ›´ã‚‚åŠ¹æœçš„ã€‚
	â€¢	å·¨å¤§ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆå¯¾ç­–
ã‚¯ãƒªã‚¢å¾Œã« ws.UsedRange ã‚’è»½ãè§¦ã‚‹ï¼ˆDim dummy:Set dummy = ws.UsedRangeï¼‰ã¨â€œå¹½éœŠUsedRangeâ€ã‚’ç¸®ã‚ã‚‰ã‚Œã¦ä¿å­˜ã‚µã‚¤ã‚ºãŒä¸‹ãŒã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

â¸»

å¿…è¦ãªã‚‰ã€æ—¢å­˜ã® ResetMasterSize ã‚’ã€ŒImport/è²¼ã‚Šä»˜ã‘å°‚ç”¨ã€ã«ã—ã¦ã€ClearData ã§ã¯å‘¼ã°ãªã„æ§‹æˆã«åˆ‡ã‚Šåˆ†ã‘ã‚‹ãƒ‘ãƒƒãƒã‚‚ç”¨æ„ã§ãã¾ã™ã€‚è©¦ã—ã¦ã¿ã¦ã€ã¾ã é‡ã„ç®‡æ‰€ãŒã‚ã‚Œã°è¨ˆæ¸¬ãƒ­ã‚°ï¼ˆå‡¦ç†æ®µéšã”ã¨ã® Timerï¼‰ä»•è¾¼ã¿ã‚‚ã”ææ¡ˆã—ã¾ã™ã€‚